/*
 * jsTree 0.9.9a
 * http://jstree.com/
 *
 * Copyright © 2009 Ivan Bozhanov (vakata.com)
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * NivoCart © 2019
 */

!function(e){function t(){return{cntr:++t.cntr,settings:e.extend({},e.tree.defaults),init:function(i,s){var r=this;if(this.container=e(i),0==this.container.size)return!1;if(t.inst[this.cntr]=this,this.container.attr("id")||this.container.attr("id","jstree_"+this.cntr),t.inst[this.container.attr("id")]=t.inst[this.cntr],t.focused=this.cntr,this.settings=e.extend(!0,{},this.settings,s),this.settings.languages&&this.settings.languages.length){this.current_lang=this.settings.languages[0];for(var n=!1,a="#"+this.container.attr("id"),l=0;l<this.settings.languages.length;l++)!1!==(n=t.add_css(a+" ."+this.settings.languages[l]))&&(n.style.display=this.settings.languages[l]==this.current_lang?"":"none")}else this.current_lang=!1;this.container.addClass("tree"),!1!==this.settings.ui.theme_name&&(!1===this.settings.ui.theme_path&&e("script").each(function(){if(this.src.toString().match(/jquery\.tree.*?js$/))return r.settings.ui.theme_path=this.src.toString().replace(/jquery\.tree.*?js$/,"")+"themes/"+r.settings.ui.theme_name+"/style.css",!1}),""!=this.settings.ui.theme_path&&-1==e.inArray(this.settings.ui.theme_path,t.themes)&&(t.add_sheet({url:this.settings.ui.theme_path}),t.themes.push(this.settings.ui.theme_path)),this.container.addClass("tree-"+this.settings.ui.theme_name));var o="";for(var d in this.settings.types)this.settings.types.hasOwnProperty(d)&&this.settings.types[d].icon&&(this.settings.types[d].icon.image||this.settings.types[d].icon.position)&&(o+="default"==d?"#"+this.container.attr("id")+" li > a ins { ":"#"+this.container.attr("id")+" li[rel="+d+"] > a ins { ",this.settings.types[d].icon.image&&(o+=" background-image:url("+this.settings.types[d].icon.image+"); "),this.settings.types[d].icon.position&&(o+=" background-position:"+this.settings.types[d].icon.position+"; "),o+="} ");""!=o&&t.add_sheet({str:o}),this.settings.rules.multiple&&(this.selected_arr=[]),this.offset=!1,this.hovered=!1,this.locked=!1,!1===t.drag_drop.marker&&(t.drag_drop.marker=e("<div>").attr({id:"jstree-marker"}).hide().appendTo("body")),this.callback("oninit",[this]),this.refresh(),this.attach_events(),this.focus()},refresh:function(t){if(this.locked)return this.error("LOCKED");var i=this;if(t&&!this.settings.data.async&&(t=!1),this.is_partial_refresh=!!t,this.opened=Array(),0!=this.settings.opened?(e.each(this.settings.opened,function(e,t){this.replace(/^#/,"").length>0&&i.opened.push("#"+this.replace(/^#/,""))}),this.settings.opened=!1):this.container.find("li.open").each(function(e){this.id&&i.opened.push("#"+this.id)}),this.selected)this.settings.selected=Array(),t?e(t).find("li:has(a.clicked)").each(function(){this.id&&i.settings.selected.push("#"+this.id)}):this.selected_arr?e.each(this.selected_arr,function(){this.attr("id")&&i.settings.selected.push("#"+this.attr("id"))}):this.selected.attr("id")&&this.settings.selected.push("#"+this.selected.attr("id"));else if(!1!==this.settings.selected){var s=Array();"object"==(typeof this.settings.selected).toLowerCase()?e.each(this.settings.selected,function(){this.replace(/^#/,"").length>0&&s.push("#"+this.replace(/^#/,""))}):this.settings.selected.replace(/^#/,"").length>0&&s.push("#"+this.settings.selected.replace(/^#/,"")),this.settings.selected=s}if(t&&this.settings.data.async)return this.opened=Array(),(t=this.get_node(t)).find("li.open").each(function(e){i.opened.push("#"+this.id)}),t.hasClass("open")&&t.removeClass("open").addClass("closed"),t.hasClass("leaf")&&t.removeClass("leaf"),t.children("ul:eq(0)").html(""),this.open_branch(t,!0,function(){i.reselect.apply(i)});i=this;var r=new e.tree.datastores[this.settings.data.type];0==this.container.children("ul").size()&&this.container.html("<ul class='ltr' style='direction:ltr;'><li class='last'><a class='loading' href='#'><ins>&nbsp;</ins>"+(this.settings.lang.loading||"Loading ...")+"</a></li></ul>"),r.load(this.callback("beforedata",[!1,this]),this,this.settings.data.opts,function(t){t=i.callback("ondata",[t,i]),r.parse(t,i,i.settings.data.opts,function(t){t=i.callback("onparse",[t,i]),i.container.empty().append(e("<ul class='ltr'>").html(t)),i.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),i.container.find("li").not(".open").not(".closed").addClass("leaf"),i.reselect()})})},reselect:function(t){var i=this;if(t?this.cl_count--:this.cl_count=0,this.opened&&this.opened.length){for(var s=!1,r=0;this.opened&&r<this.opened.length;r++){if(this.settings.data.async){if((n=this.get_node(this.opened[r])).size()&&n.hasClass("closed")>0){s=!0;var n=this.opened[r].toString().replace("/","\\/");delete this.opened[r],this.open_branch(n,!0,function(){i.reselect.apply(i,[!0])}),this.cl_count++}}else this.open_branch(this.opened[r],!0)}if(this.settings.data.async&&s)return;if(this.cl_count>0)return;delete this.opened}this.cl_count>0||(this.container.css("direction","ltr").children("ul:eq(0)").addClass("ltr"),0==this.settings.ui.dots&&this.container.children("ul:eq(0)").addClass("no_dots"),this.scrtop&&(this.container.scrollTop(i.scrtop),delete this.scrtop),!1!==this.settings.selected&&(e.each(this.settings.selected,function(t){i.is_partial_refresh?i.select_branch(e(i.settings.selected[t].toString().replace("/","\\/"),i.container),!1!==i.settings.rules.multiple):i.select_branch(e(i.settings.selected[t].toString().replace("/","\\/"),i.container),!1!==i.settings.rules.multiple&&t>0)}),this.settings.selected=!1),this.callback("onload",[i]))},get:function(t,i,s){return i||(i=this.settings.data.type),s||(s=this.settings.data.opts),(new e.tree.datastores[i]).get(t,this,s)},attach_events:function(){var i=this;this.container.bind("mousedown.jstree",function(e){if(t.drag_drop.isdown)return t.drag_drop.move_type=!1,e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1}).bind("mouseup.jstree",function(e){setTimeout(function(){i.focus.apply(i)},5)}).bind("click.jstree",function(e){return!0}),e("#"+this.container.attr("id")+" li").live("click",function(t){return"LI"!=t.target.tagName||(i.off_height(),t.pageY-e(t.target).offset().top>i.li_height||(i.toggle_branch.apply(i,[t.target]),t.stopPropagation(),!1))}),e("#"+this.container.attr("id")+" li a").live("click.jstree",function(e){return!(!e.which||3!=e.which)||(i.locked?(e.preventDefault(),e.target.blur(),i.error("LOCKED")):(i.select_branch.apply(i,[e.target,e.ctrlKey||"on"==i.settings.rules.multiple]),i.inp&&i.inp.blur(),e.preventDefault(),e.target.blur(),!1))}).live("dblclick.jstree",function(e){if(i.locked)return e.preventDefault(),e.stopPropagation(),e.target.blur(),i.error("LOCKED");i.callback("ondblclk",[i.get_node(e.target).get(0),i]),e.preventDefault(),e.stopPropagation(),e.target.blur()}).live("contextmenu.jstree",function(e){return i.locked?(e.target.blur(),i.error("LOCKED")):i.callback("onrgtclk",[i.get_node(e.target).get(0),i,e])}).live("mouseover.jstree",function(e){if(i.locked)return e.preventDefault(),e.stopPropagation(),i.error("LOCKED");!1===i.hovered||"A"!=e.target.tagName&&"INS"!=e.target.tagName||(i.hovered.children("a").removeClass("hover"),i.hovered=!1),i.callback("onhover",[i.get_node(e.target).get(0),i])}).live("mousedown.jstree",function(s){if("left"==i.settings.rules.drag_button&&s.which&&1!=s.which)return!0;if("right"==i.settings.rules.drag_button&&s.which&&3!=s.which)return!0;if(i.focus.apply(i),i.locked)return i.error("LOCKED");var r=i.get_node(s.target);if(0!=i.settings.rules.multiple&&i.selected_arr.length>1&&r.children("a:eq(0)").hasClass("clicked")){var n=0;for(var a in i.selected_arr)i.selected_arr.hasOwnProperty(a)&&i.check("draggable",i.selected_arr[a])&&(i.selected_arr[a].addClass("dragged"),t.drag_drop.origin_tree=i,n++);if(n>0){i.check("draggable",r)?t.drag_drop.drag_node=r:t.drag_drop.drag_node=i.container.find("li.dragged:eq(0)"),t.drag_drop.isdown=!0,t.drag_drop.drag_help=e("<div id='jstree-dragged' class='tree "+(""!=i.settings.ui.theme_name?" tree-"+i.settings.ui.theme_name:"")+"' />").append("<ul class='"+i.container.children("ul:eq(0)").get(0).className+"' />");var l=t.drag_drop.drag_node.clone();i.settings.languages.length>0&&l.find("a").not("."+i.current_lang).hide(),t.drag_drop.drag_help.children("ul:eq(0)").append(l),t.drag_drop.drag_help.find("li:eq(0)").removeClass("last").addClass("last").children("a").html("<ins>&nbsp;</ins>Multiple selection").end().children("ul").remove(),t.drag_drop.dragged=i.container.find("li.dragged")}}else if(i.check("draggable",r)){t.drag_drop.drag_node=r,t.drag_drop.drag_help=e("<div id='jstree-dragged' class='tree "+(""!=i.settings.ui.theme_name?" tree-"+i.settings.ui.theme_name:"")+"' />").append("<ul class='"+i.container.children("ul:eq(0)").get(0).className+"' />");l=r.clone();i.settings.languages.length>0&&l.find("a").not("."+i.current_lang).hide(),t.drag_drop.drag_help.children("ul:eq(0)").append(l),t.drag_drop.drag_help.find("li:eq(0)").removeClass("last").addClass("last"),t.drag_drop.isdown=!0,t.drag_drop.foreign=!1,t.drag_drop.origin_tree=i,r.addClass("dragged"),t.drag_drop.dragged=i.container.find("li.dragged")}return t.drag_drop.init_x=s.pageX,t.drag_drop.init_y=s.pageY,r.blur(),s.preventDefault(),s.stopPropagation(),!1})},focus:function(){if(this.locked)return!1;t.focused!=this.cntr&&(t.focused=this.cntr,this.callback("onfocus",[this]))},off_height:function(){if(!1===this.offset){this.container.css({position:"relative"}),this.offset=this.container.offset();var t=0;(t=parseInt(e.curCSS(this.container.get(0),"paddingTop",!0),10))&&(this.offset.top+=t),(t=parseInt(e.curCSS(this.container.get(0),"borderTopWidth",!0),10))&&(this.offset.top+=t),this.container.css({position:""})}if(!this.li_height){t=this.container.find("ul li.closed, ul li.leaf").eq(0);this.li_height=t.height(),t.children("ul:eq(0)").size()&&(this.li_height-=t.children("ul:eq(0)").height()),this.li_height||(this.li_height=18)}},scroll_check:function(e,i){var s=this,r=s.container,n=s.container.offset(),a=r.scrollTop(),l=r.scrollLeft(),o=r.get(0).scrollWidth>r.width()?40:20;i-n.top<20&&r.scrollTop(Math.max(a-s.settings.ui.scroll_spd,0)),r.height()-(i-n.top)<o&&r.scrollTop(a+s.settings.ui.scroll_spd),e-n.left<20&&r.scrollLeft(Math.max(l-s.settings.ui.scroll_spd,0)),r.width()-(e-n.left)<40&&r.scrollLeft(l+s.settings.ui.scroll_spd),r.scrollLeft()==l&&r.scrollTop()==a||(t.drag_drop.move_type=!1,t.drag_drop.ref_node=!1,t.drag_drop.marker.hide()),t.drag_drop.scroll_time=setTimeout(function(){s.scroll_check(e,i)},50)},scroll_into_view:function(e){if(!(e=e?this.get_node(e):this.selected))return!1;var t=e.offset().top,i=this.container.offset().top,s=i+this.container.height(),r=this.container.get(0).scrollWidth>this.container.width()?40:20;t+5<i&&this.container.scrollTop(this.container.scrollTop()-(i-t+5)),t+r>s&&this.container.scrollTop(this.container.scrollTop()+(t+r-s))},get_node:function(t){return e(t).closest("li")},get_type:function(e){if(e=e?this.get_node(e):this.selected)return e.attr(this.settings.rules.type_attr)||"default"},set_type:function(e,t){(t=t?this.get_node(t):this.selected)&&e&&t.attr(this.settings.rules.type_attr,e)},get_text:function(e,t){if(!(e=this.get_node(e))||0==e.size())return"";this.settings.languages&&this.settings.languages.length?(t=t||this.current_lang,e=e.children("a."+t)):e=e.children("a:visible");var i="";return e.contents().each(function(){if(3==this.nodeType)return i=this.data,!1}),i},check:function(e,t){if(this.locked)return!1;var i=!1;if(-1===t)void 0!==this.settings.rules[e]&&(i=this.settings.rules[e]);else{if(!(t=t?this.get_node(t):this.selected))return;var s=this.get_type(t);void 0!==this.settings.types[s]&&void 0!==this.settings.types[s][e]?i=this.settings.types[s][e]:void 0!==this.settings.types.default&&void 0!==this.settings.types.default[e]&&(i=this.settings.types.default[e])}return"function"==typeof i&&(i=i.call(null,t,this)),i=this.callback("check",[e,t,i,this])},check_move:function(i,s,r){if(this.locked)return!1;if(e(s).closest("li.dragged").size())return!1;var n=i.parents(".tree:eq(0)").get(0),a=s.parents(".tree:eq(0)").get(0);if(n&&n!=a&&("none"==(g=e.tree.reference(a.id).settings.rules.multitree)||e.isArray(g)&&-1==e.inArray(n.id,g)))return!1;var l="inside"!=r?this.parent(s):this.get_node(s);if(i=this.get_node(i),0==l)return!1;var o={max_depth:this.settings.rules.use_max_depth?this.check("max_depth",l):-1,max_children:this.settings.rules.use_max_children?this.check("max_children",l):-1,valid_children:this.check("valid_children",l)},d="string"==typeof i?i:this.get_type(i);if(void 0!==o.valid_children&&("none"==o.valid_children||"object"==typeof o.valid_children&&-1==e.inArray(d,e.makeArray(o.valid_children))))return!1;if(this.settings.rules.use_max_children&&void 0!==o.max_children&&-1!=o.max_children){if(0==o.max_children)return!1;var c=1;if(1==t.drag_drop.moving&&0==t.drag_drop.foreign&&(c=t.drag_drop.dragged.size(),c-=l.find("> ul > li.dragged").size()),o.max_children<l.find("> ul > li").size()+c)return!1}if(this.settings.rules.use_max_depth){if(void 0!==o.max_depth&&0===o.max_depth)return this.error("MOVE: MAX-DEPTH REACHED");for(var h=o.max_depth>0&&o.max_depth,u=0,p=l;-1!==p;){var g;if(p=this.parent(p),u++,(g=this.check("max_depth",p))>=0&&(h=!1===h?g-u:Math.min(h,g-u)),!1!==h&&h<=0)return this.error("MOVE: MAX-DEPTH REACHED")}if(!1!==h&&h<=0)return this.error("MOVE: MAX-DEPTH REACHED");if(!1!==h){var f=1;if("string"!=typeof i)for(p=i;p.size()>0;){if(h-f<0)return this.error("MOVE: MAX-DEPTH REACHED");p=p.children("ul").children("li"),f++}}}return 0!=this.callback("check_move",[i,s,r,this])},hover_branch:function(e){if(this.locked)return this.error("LOCKED");return(e=this.get_node(e)).size()?this.check("clickable",e)?(this.hovered&&this.hovered.children("A").removeClass("hover"),this.hovered=e,this.hovered.children("a").addClass("hover"),void this.scroll_into_view(this.hovered)):this.error("SELECT: NODE NOT SELECTABLE"):this.error("HOVER: NOT A VALID NODE")},select_branch:function(e,t){if(this.locked)return this.error("LOCKED");e||!1===this.hovered||(e=this.hovered);var i=this;if(!(e=i.get_node(e)).size())return this.error("SELECT: NOT A VALID NODE");if(e.children("a").removeClass("hover"),!i.check("clickable",e))return this.error("SELECT: NODE NOT SELECTABLE");if(!1===i.callback("beforechange",[e.get(0),i]))return this.error("SELECT: STOPPED BY USER");if(0!=this.settings.rules.multiple&&t&&e.children("a.clicked").size()>0)return this.deselect_branch(e);if(0!=this.settings.rules.multiple&&t&&this.selected_arr.push(e),0!=this.settings.rules.multiple&&!t){for(var s in this.selected_arr)this.selected_arr.hasOwnProperty(s)&&(this.selected_arr[s].children("A").removeClass("clicked"),this.callback("ondeselect",[this.selected_arr[s].get(0),i]));this.selected_arr=[],this.selected_arr.push(e),this.selected&&this.selected.children("A").hasClass("clicked")&&(this.selected.children("A").removeClass("clicked"),this.callback("ondeselect",[this.selected.get(0),i]))}this.settings.rules.multiple||this.selected&&(this.selected.children("A").removeClass("clicked"),this.callback("ondeselect",[this.selected.get(0),i])),this.selected=e,!1!==this.hovered&&(this.hovered.children("A").removeClass("hover"),this.hovered=e),this.selected.children("a").addClass("clicked").end().parents("li.closed").each(function(){i.open_branch(this,!0)}),this.scroll_into_view(this.selected),this.callback("onselect",[this.selected.get(0),i]),this.callback("onchange",[this.selected.get(0),i])},deselect_branch:function(t){if(this.locked)return this.error("LOCKED");var i=this;if(0==(t=this.get_node(t)).children("a.clicked").size())return this.error("DESELECT: NODE NOT SELECTED");t.children("a").removeClass("clicked"),this.callback("ondeselect",[t.get(0),i]),0!=this.settings.rules.multiple&&this.selected_arr.length>1?(this.selected_arr=[],this.container.find("a.clicked").filter(":first-child").parent().each(function(){i.selected_arr.push(e(this))}),t.get(0)==this.selected.get(0)&&(this.selected=this.selected_arr[0])):(0!=this.settings.rules.multiple&&(this.selected_arr=[]),this.selected=!1),this.callback("onchange",[t.get(0),i])},toggle_branch:function(e){return this.locked?this.error("LOCKED"):(e=this.get_node(e)).hasClass("closed")?this.open_branch(e):e.hasClass("open")?this.close_branch(e):void 0},open_branch:function(t,i,s){var r=this;if(this.locked)return this.error("LOCKED");if(!(t=this.get_node(t)).size())return this.error("OPEN: NO SUCH NODE");if(t.hasClass("leaf"))return this.error("OPEN: OPENING LEAF NODE");if(this.settings.data.async&&0==t.find("li").size()){if(!1===this.callback("beforeopen",[t.get(0),this]))return this.error("OPEN: STOPPED BY USER");t.children("ul:eq(0)").remove().end().append("<ul><li class='last'><a class='loading' href='#'><ins>&nbsp;</ins>"+(r.settings.lang.loading||"Loading ...")+"</a></li></ul>"),t.removeClass("closed").addClass("open");var n=new e.tree.datastores[this.settings.data.type];return n.load(this.callback("beforedata",[t,this]),this,this.settings.data.opts,function(i){if(!(i=r.callback("ondata",[i,r]))||0==i.length)return t.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove(),void(s&&s.call());n.parse(i,r,r.settings.data.opts,function(i){i=r.callback("onparse",[i,r]),t.children("ul:eq(0)").replaceWith(e("<ul>").html(i)),t.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),t.find("li").not(".open").not(".closed").addClass("leaf"),r.open_branch.apply(r,[t]),s&&s.call()})}),!0}return this.settings.data.async||!1!==this.callback("beforeopen",[t.get(0),this])?(parseInt(this.settings.ui.animation)>0&&!i?(t.children("ul:eq(0)").css("display","none"),t.removeClass("closed").addClass("open"),t.children("ul:eq(0)").slideDown(parseInt(this.settings.ui.animation),function(){e(this).css("display",""),s&&s.call()})):(t.removeClass("closed").addClass("open"),s&&s.call()),this.callback("onopen",[t.get(0),this]),!0):this.error("OPEN: STOPPED BY USER")},close_branch:function(t,i){if(this.locked)return this.error("LOCKED");var s=this;return(t=this.get_node(t)).size()?!1===s.callback("beforeclose",[t.get(0),s])?this.error("CLOSE: STOPPED BY USER"):(parseInt(this.settings.ui.animation)>0&&!i&&1==t.children("ul:eq(0)").size()?t.children("ul:eq(0)").slideUp(parseInt(this.settings.ui.animation),function(){t.hasClass("open")&&t.removeClass("open").addClass("closed"),e(this).css("display","")}):t.hasClass("open")&&t.removeClass("open").addClass("closed"),this.selected&&!1!==this.settings.ui.selected_parent_close&&t.children("ul:eq(0)").find("a.clicked").size()>0&&(t.find("li:has(a.clicked)").each(function(){s.deselect_branch(this)}),"select_parent"==this.settings.ui.selected_parent_close&&0==t.children("a.clicked").size()&&this.select_branch(t,0!=this.settings.rules.multiple&&this.selected_arr.length>0)),void this.callback("onclose",[t.get(0),this])):this.error("CLOSE: NO SUCH NODE")},open_all:function(e,t){if(this.locked)return this.error("LOCKED");var i=this,s=(e=e?this.get_node(e):this.container).find("li.closed").size();t?this.cl_count--:this.cl_count=0,s>0?(this.cl_count+=s,e.find("li.closed").each(function(){var e=this;i.open_branch.apply(i,[this,!0,function(){i.open_all.apply(i,[e,!0])}])})):0==this.cl_count&&this.callback("onopen_all",[this])},close_all:function(e){if(this.locked)return this.error("LOCKED");var t=this;(e=e?this.get_node(e):this.container).find("li.open").each(function(){t.close_branch(this,!0)}),this.callback("onclose_all",[this])},set_lang:function(i){if(!e.isArray(this.settings.languages)||0==this.settings.languages.length)return!1;if(this.locked)return this.error("LOCKED");if(e.inArray(i,this.settings.languages)||void 0===this.settings.languages[i]||(i=this.settings.languages[i]),void 0===i)return!1;if(i==this.current_lang)return!0;var s=!1,r="#"+this.container.attr("id");return!1!==(s=t.get_css(r+" ."+this.current_lang))&&(s.style.display="none"),!1!==(s=t.get_css(r+" ."+i))&&(s.style.display=""),this.current_lang=i,!0},get_lang:function(){return!(!e.isArray(this.settings.languages)||0==this.settings.languages.length)&&this.current_lang},create:function(t,i,s){if(this.locked)return this.error("LOCKED");var r=!1;if(-1==i?(r=!0,i=this.container):i=i?this.get_node(i):this.selected,!(r||i&&i.size()))return this.error("CREATE: NO NODE SELECTED");var n=s,a=i;if("before"==s&&(s=i.parent().children().index(i),i=i.parents("li:eq(0)")),"after"==s&&(s=i.parent().children().index(i)+1,i=i.parents("li:eq(0)")),r||0!=i.size()||(r=!0,i=this.container),!r){if(!this.check("creatable",i))return this.error("CREATE: CANNOT CREATE IN NODE");if(i.hasClass("closed")){if(this.settings.data.async&&0==i.children("ul").size()){var l=this;return this.open_branch(i,!0,function(){l.create.apply(l,[t,i,s])})}this.open_branch(i,!0)}}var o=!1;if((t=t?e.extend(!0,{},t):{}).attributes||(t.attributes={}),t.attributes[this.settings.rules.type_attr]||(t.attributes[this.settings.rules.type_attr]=this.get_type(a)||"default"),this.settings.languages.length){t.data||(t.data={},o=!0);for(var d=0;d<this.settings.languages.length;d++)t.data[this.settings.languages[d]]||(t.data[this.settings.languages[d]]="string"!=(typeof this.settings.lang.new_node).toLowerCase()&&this.settings.lang.new_node[d]?this.settings.lang.new_node[d]:this.settings.lang.new_node)}else t.data||(t.data=this.settings.lang.new_node,o=!0);t=this.callback("ondata",[t,this]);var c=e.tree.datastores.json().parse(t,this);c=this.callback("onparse",[c,this]);var h=e(c);h.children("ul").size()?h.is(".open")||h.addClass("closed"):h.addClass("leaf"),h.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),h.find("li").not(".open").not(".closed").addClass("leaf");var u={max_depth:this.settings.rules.use_max_depth?this.check("max_depth",r?-1:i):-1,max_children:this.settings.rules.use_max_children?this.check("max_children",r?-1:i):-1,valid_children:this.check("valid_children",r?-1:i)},p=this.get_type(h);if(void 0!==u.valid_children&&("none"==u.valid_children||e.isArray(u.valid_children)&&-1==e.inArray(p,u.valid_children)))return this.error("CREATE: NODE NOT A VALID CHILD");if(this.settings.rules.use_max_children&&void 0!==u.max_children&&-1!=u.max_children&&u.max_children>=this.children(i).size())return this.error("CREATE: MAX_CHILDREN REACHED");if(this.settings.rules.use_max_depth){if(void 0!==u.max_depth&&0===u.max_depth)return this.error("CREATE: MAX-DEPTH REACHED");for(var g=u.max_depth>0&&u.max_depth,f=(d=0,i);-1!==f&&!r;){f=this.parent(f),d++;var _=this.check("max_depth",f);if(_>=0&&(g=!1===g?_-d:Math.min(g,_-d)),!1!==g&&g<=0)return this.error("CREATE: MAX-DEPTH REACHED")}if(!1!==g&&g<=0)return this.error("CREATE: MAX-DEPTH REACHED");if(!1!==g){var m=1;for(f=h;f.size()>0;){if(g-m<0)return this.error("CREATE: MAX-DEPTH REACHED");f=f.children("ul").children("li"),m++}}}if("undefined"!=(typeof s).toLowerCase()&&"inside"!=s||(s="top"==this.settings.rules.createat?0:i.children("ul:eq(0)").children("li").size()),0==i.children("ul").size()||1==r&&0==i.children("ul").children("li").size())if(r)v=this.moved(h,this.container.children("ul:eq(0)"),"inside",!0);else var v=this.moved(h,i.children("a:eq(0)"),"inside",!0);else if("before"==n&&i.children("ul:eq(0)").children("li:nth-child("+(s+1)+")").size())v=this.moved(h,i.children("ul:eq(0)").children("li:nth-child("+(s+1)+")").children("a:eq(0)"),"before",!0);else if("after"==n&&i.children("ul:eq(0)").children("li:nth-child("+s+")").size())v=this.moved(h,i.children("ul:eq(0)").children("li:nth-child("+s+")").children("a:eq(0)"),"after",!0);else if(i.children("ul:eq(0)").children("li:nth-child("+(s+1)+")").size())v=this.moved(h,i.children("ul:eq(0)").children("li:nth-child("+(s+1)+")").children("a:eq(0)"),"before",!0);else v=this.moved(h,i.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",!0);return!1===v?this.error("CREATE: ABORTED"):(o&&(this.select_branch(h.children("a:eq(0)")),this.rename()),h)},rename:function(t,i){if(this.locked)return this.error("LOCKED");var s=this;if(!(t=t?this.get_node(t):this.selected)||!t.size())return this.error("RENAME: NO NODE SELECTED");if(!this.check("renameable",t))return this.error("RENAME: NODE NOT RENAMABLE");if(!this.callback("beforerename",[t.get(0),s.current_lang,s]))return this.error("RENAME: STOPPED BY USER");t.parents("li.closed").each(function(){s.open_branch(this)}),t=this.current_lang?t.find("a."+this.current_lang):t.find("a:first");var r={};r[this.container.attr("id")]=this.get_rollback();var n=t.children("ins").clone();if("string"==(typeof i).toLowerCase())t.text(i).prepend(n),s.callback("onrename",[s.get_node(t).get(0),s,r]);else{var a="";t.contents().each(function(){if(3==this.nodeType)return a=this.data,!1}),s.inp=e("<input type='text' autocomplete='off' />"),s.inp.val(a.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<")).bind("mousedown",function(e){e.stopPropagation()}).bind("mouseup",function(e){e.stopPropagation()}).bind("click",function(e){e.stopPropagation()}).bind("keyup",function(e){var t=e.keyCode||e.which;if(27==t)return this.value=a,void this.blur();13!=t||this.blur()}),s.inp.blur(function(e){""==this.value&&(this.value=a),t.text(this.value).prepend(n),t.get(0).style.display="",t.prevAll("span").remove(),s.inp=!1,s.callback("onrename",[s.get_node(t).get(0),s,r])});var l=e("<span />").addClass(t.attr("class")).append(n).append(s.inp);t.get(0).style.display="none",t.parent().prepend(l),s.inp.get(0).focus(),s.inp.get(0).select()}},remove:function(t){if(this.locked)return this.error("LOCKED");var i=this,s={};if(s[this.container.attr("id")]=this.get_rollback(),!t||this.selected&&this.get_node(t).get(0)==this.selected.get(0)){if(!this.selected)return this.error("DELETE: NO NODE SELECTED");if(!this.check("deletable",this.selected))return this.error("DELETE: NODE NOT DELETABLE");if(!this.callback("beforedelete",[this.selected.get(0),i]))return this.error("DELETE: STOPPED BY USER");$parent=this.selected.parent();t=this.selected;if(0==this.settings.rules.multiple||1==this.selected_arr.length)var r=!0,n="select_previous"==this.settings.ui.selected_delete&&this.prev(this.selected);if(t=t.remove(),$parent.children("li:last").addClass("last"),0==$parent.children("li").size()&&($li=$parent.parents("li:eq(0)"),$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove()),!r&&0!=this.settings.rules.multiple){i=this;this.selected_arr=[],this.container.find("a.clicked").filter(":first-child").parent().each(function(){i.selected_arr.push(e(this))}),this.selected_arr.length>0&&(this.selected=this.selected_arr[0],this.remove())}r&&n&&this.select_branch(n),this.callback("ondelete",[t.get(0),this,s])}else if((t=this.get_node(t)).size()){if(!this.check("deletable",t))return this.error("DELETE: NODE NOT DELETABLE");if(!this.callback("beforedelete",[t.get(0),i]))return this.error("DELETE: STOPPED BY USER");if($parent=t.parent(),t.find("a.clicked").size()){var a=!1;i.selected_arr=[],this.container.find("a.clicked").filter(":first-child").parent().each(function(){if(a||this!=i.selected.get(0)||(a=!0),-1!=e(this).parents().index(t))return!0;i.selected_arr.push(e(this))}),a&&(this.selected=this.selected_arr[0]||!1)}t=t.remove(),$parent.children("li:last").addClass("last"),0==$parent.children("li").size()&&($li=$parent.parents("li:eq(0)"),$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove()),this.callback("ondelete",[t.get(0),this,s])}},next:function(e,t){return!!(e=this.get_node(e)).size()&&(t?e.nextAll("li").size()>0&&e.nextAll("li:eq(0)"):e.hasClass("open")?e.find("li:eq(0)"):e.nextAll("li").size()>0?e.nextAll("li:eq(0)"):e.parents("li").next("li").eq(0))},prev:function(e,t){if(!(e=this.get_node(e)).size())return!1;if(t)return e.prevAll("li").size()>0&&e.prevAll("li:eq(0)");if(e.prev("li").size()){for(e=e.prev("li").eq(0);e.hasClass("open");)e=e.children("ul:eq(0)").children("li:last");return e}return!!e.parents("li:eq(0)").size()&&e.parents("li:eq(0)")},parent:function(e){return!!(e=this.get_node(e)).size()&&(e.parents("li:eq(0)").size()?e.parents("li:eq(0)"):-1)},children:function(e){return-1===e?this.container.children("ul:eq(0)").children("li"):!!(e=this.get_node(e)).size()&&e.children("ul:eq(0)").children("li")},toggle_dots:function(){this.settings.ui.dots?(this.settings.ui.dots=!1,this.container.children("ul:eq(0)").addClass("no_dots")):(this.settings.ui.dots=!0,this.container.children("ul:eq(0)").removeClass("no_dots"))},callback:function(t,i){var s=!1,r=null;for(var n in this.settings.plugins)if("object"==typeof e.tree.plugins[n]&&((s=e.tree.plugins[n]).callbacks&&"function"==typeof s.callbacks[t]&&(r=s.callbacks[t].apply(this,i)),void 0!==r&&null!==r)){if("ondata"!=t&&"onparse"!=t)return r;i[0]=r}if("function"==typeof(s=this.settings.callback[t]))return s.apply(null,i)},get_rollback:function(){var e={};return e.html=this.container.html(),e.selected=!!this.selected&&this.selected.attr("id"),e},moved:function(i,s,r,n,a,l){i=e(i);var o=e(i).parents("ul:eq(0)"),d=e(s);(d.is("ins")&&(d=d.parent()),l)||((l={})[this.container.attr("id")]=this.get_rollback(),n||((h=i.size()>1?i.eq(0).parents(".tree:eq(0)"):i.parents(".tree:eq(0)")).get(0)!=this.container.get(0)&&(h=t.inst[h.attr("id")],l[h.container.attr("id")]=h.get_rollback()),delete h));if("inside"==r&&this.settings.data.async){var c=this;if(this.get_node(d).hasClass("closed"))return this.open_branch(this.get_node(d),!0,function(){c.moved.apply(c,[i,s,r,n,a,l])});if(1==this.get_node(d).find("> ul > li > a.loading").size())return void setTimeout(function(){c.moved.apply(c,[i,s,r,n,a])},200)}if(i.size()>1){c=this;var h=this.moved(i.eq(0),s,r,!1,a,l);return i.each(function(e){0!=e&&h&&(h=c.moved(this,h.children("a:eq(0)"),"after",!1,a,l))}),i}if(a?(_what=i.clone(),_what.each(function(t){this.id=this.id+"_copy",e(this).find("li").each(function(){this.id=this.id+"_copy"}),e(this).removeClass("dragged").find("a.clicked").removeClass("clicked").end().find("li.dragged").removeClass("dragged")})):_what=i,n){if(!this.callback("beforecreate",[this.get_node(i).get(0),this.get_node(s).get(0),r,this]))return!1}else if(!this.callback("beforemove",[this.get_node(i).get(0),this.get_node(s).get(0),r,this]))return!1;if(!n&&(h=i.parents(".tree:eq(0)")).get(0)!=this.container.get(0)){if((h=t.inst[h.attr("id")]).settings.languages.length){var u=[];if(0==this.settings.languages.length)u.push("."+h.current_lang);else for(var p in this.settings.languages)if(this.settings.languages.hasOwnProperty(p))for(var g in h.settings.languages)h.settings.languages.hasOwnProperty(g)&&this.settings.languages[p]==h.settings.languages[g]&&u.push("."+this.settings.languages[p]);if(0==u.length)return this.error("MOVE: NO COMMON LANGUAGES");_what.find("a").not(u.join(",")).remove()}_what.find("a.clicked").removeClass("clicked")}switch(i=_what,r){case"before":d.parents("ul:eq(0)").children("li.last").removeClass("last"),d.parent().before(i.removeClass("last")),d.parents("ul:eq(0)").children("li:last").addClass("last");break;case"after":d.parents("ul:eq(0)").children("li.last").removeClass("last"),d.parent().after(i.removeClass("last")),d.parents("ul:eq(0)").children("li:last").addClass("last");break;case"inside":var f;if(d.parent().children("ul:first").size())if("top"==this.settings.rules.createat)d.parent().children("ul:first").prepend(i.removeClass("last")).children("li:last").addClass("last"),(f=d.parent().children("ul:first").children("li:first")).size()&&(r="before",s=f);else(f=d.parent().children("ul:first").children(".last")).size()&&(r="after",s=f),d.parent().children("ul:first").children(".last").removeClass("last").end().append(i.removeClass("last")).children("li:last").addClass("last");else i.addClass("last"),d.parent().removeClass("leaf").append("<ul/>"),d.parent().hasClass("open")||d.parent().addClass("closed"),d.parent().children("ul:first").prepend(i);d.parent().hasClass("closed")&&this.open_branch(d)}if(0==o.find("li").size()){var _=o.parent();_.removeClass("open").removeClass("closed").addClass("leaf"),_.is(".tree")||_.children("ul").remove(),_.parents("ul:eq(0)").children("li.last").removeClass("last").end().children("li:last").addClass("last")}else o.children("li.last").removeClass("last"),o.children("li:last").addClass("last");return a?this.callback("oncopy",[this.get_node(i).get(0),this.get_node(s).get(0),r,this,l]):n?this.callback("oncreate",[this.get_node(i).get(0),d.is("ul")?-1:this.get_node(s).get(0),r,this,l]):this.callback("onmove",[this.get_node(i).get(0),this.get_node(s).get(0),r,this,l]),i},error:function(e){return this.callback("error",[e,this]),!1},lock:function(e){this.locked=e,this.locked?this.container.children("ul:eq(0)").addClass("locked"):this.container.children("ul:eq(0)").removeClass("locked")},cut:function(e){return this.locked?this.error("LOCKED"):(e=e?this.get_node(e):this.container.find("a.clicked").filter(":first-child").parent())&&e.size()?(t.cut_copy.copy_nodes=!1,void(t.cut_copy.cut_nodes=e)):this.error("CUT: NO NODE SELECTED")},copy:function(e){return this.locked?this.error("LOCKED"):(e=e?this.get_node(e):this.container.find("a.clicked").filter(":first-child").parent())&&e.size()?(t.cut_copy.copy_nodes=e,void(t.cut_copy.cut_nodes=!1)):this.error("COPY: NO NODE SELECTED")},paste:function(e,i){if(this.locked)return this.error("LOCKED");var s=!1;if(-1==e?(s=!0,e=this.container):e=e?this.get_node(e):this.selected,!(s||e&&e.size()))return this.error("PASTE: NO NODE SELECTED");if(!t.cut_copy.copy_nodes&&!t.cut_copy.cut_nodes)return this.error("PASTE: NOTHING TO DO");var r=i;if("before"==i?(i=e.parent().children().index(e),e=e.parents("li:eq(0)")):"after"==i?(i=e.parent().children().index(e)+1,e=e.parents("li:eq(0)")):"undefined"!=(typeof i).toLowerCase()&&"inside"!=i||(i="top"==this.settings.rules.createat?0:e.children("ul:eq(0)").children("li").size()),s||0!=e.size()||(s=!0,e=this.container),t.cut_copy.copy_nodes&&t.cut_copy.copy_nodes.size()){var n=!0;if(!s&&!this.check_move(t.cut_copy.copy_nodes,e.children("a:eq(0)"),"inside"))return!1;if(0==e.children("ul").size()||1==s&&0==e.children("ul").children("li").size())if(s)this.moved(t.cut_copy.copy_nodes,this.container.children("ul:eq(0)"),"inside",!1,!0);else this.moved(t.cut_copy.copy_nodes,e.children("a:eq(0)"),"inside",!1,!0);else if("before"==r&&e.children("ul:eq(0)").children("li:nth-child("+(i+1)+")").size())this.moved(t.cut_copy.copy_nodes,e.children("ul:eq(0)").children("li:nth-child("+(i+1)+")").children("a:eq(0)"),"before",!1,!0);else if("after"==r&&e.children("ul:eq(0)").children("li:nth-child("+i+")").size())this.moved(t.cut_copy.copy_nodes,e.children("ul:eq(0)").children("li:nth-child("+i+")").children("a:eq(0)"),"after",!1,!0);else if(e.children("ul:eq(0)").children("li:nth-child("+(i+1)+")").size())this.moved(t.cut_copy.copy_nodes,e.children("ul:eq(0)").children("li:nth-child("+(i+1)+")").children("a:eq(0)"),"before",!1,!0);else this.moved(t.cut_copy.copy_nodes,e.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",!1,!0);t.cut_copy.copy_nodes=!1}if(t.cut_copy.cut_nodes&&t.cut_copy.cut_nodes.size()){n=!0;if(e.parents().andSelf().each(function(){if(-1!=t.cut_copy.cut_nodes.index(this))return n=!1,!1}),!n)return this.error("Invalid paste");if(!s&&!this.check_move(t.cut_copy.cut_nodes,e.children("a:eq(0)"),"inside"))return!1;if(0==e.children("ul").size()||1==s&&0==e.children("ul").children("li").size())if(s)this.moved(t.cut_copy.cut_nodes,this.container.children("ul:eq(0)"),"inside");else this.moved(t.cut_copy.cut_nodes,e.children("a:eq(0)"),"inside");else if("before"==r&&e.children("ul:eq(0)").children("li:nth-child("+(i+1)+")").size())this.moved(t.cut_copy.cut_nodes,e.children("ul:eq(0)").children("li:nth-child("+(i+1)+")").children("a:eq(0)"),"before");else if("after"==r&&e.children("ul:eq(0)").children("li:nth-child("+i+")").size())this.moved(t.cut_copy.cut_nodes,e.children("ul:eq(0)").children("li:nth-child("+i+")").children("a:eq(0)"),"after");else if(e.children("ul:eq(0)").children("li:nth-child("+(i+1)+")").size())this.moved(t.cut_copy.cut_nodes,e.children("ul:eq(0)").children("li:nth-child("+(i+1)+")").children("a:eq(0)"),"before");else this.moved(t.cut_copy.cut_nodes,e.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after");t.cut_copy.cut_nodes=!1}},search:function(t,i){var s=this;if((!t||this.srch&&t!=this.srch)&&(this.srch="",this.srch_opn=!1,this.container.find("a.search").removeClass("search")),this.srch=t,t)if(i||(i="contains"),this.settings.data.async)if(this.srch_opn)if(this.srch_opn.length){if(this.srch_opn&&this.srch_opn.length){for(var r=!1,n=0;n<this.srch_opn.length;n++)if(this.get_node("#"+this.srch_opn[n]).size()>0){r=!0;var a="#"+this.srch_opn[n];delete this.srch_opn[n],this.open_branch(a,!0,function(){s.search.apply(s,[t,i])})}r||(this.srch_opn=[],s.search.apply(s,[t,i]))}}else{this.srch_opn=!1;var l="a";this.settings.languages.length&&(l+="."+this.current_lang),this.callback("onsearch",[this.container.find(l+":"+i+"('"+t+"')"),this])}else{var o=e.extend({search:t},this.callback("beforedata",[!1,this]));e.ajax({type:this.settings.data.opts.method,url:this.settings.data.opts.url,data:o,dataType:"text",success:function(r){s.srch_opn=e.unique(r.split(",")),s.search.apply(s,[t,i])}})}else{l="a";this.settings.languages.length&&(l+="."+this.current_lang);var d=this.container.find(l+":"+i+"('"+t+"')");d.parents("li.closed").each(function(){s.open_branch(this,!0)}),this.callback("onsearch",[d,this])}},add_sheet:t.add_sheet,destroy:function(){if(this.callback("ondestroy",[this]),this.container.unbind(".jstree"),e("#"+this.container.attr("id")).die("click.jstree").die("dblclick.jstree").die("mouseover.jstree").die("mouseout.jstree").die("mousedown.jstree"),this.container.removeClass("tree ui-widget ui-widget-content tree-default tree-"+this.settings.ui.theme_name).children("ul").removeClass("no_dots ltr locked").find("li").removeClass("leaf").removeClass("open").removeClass("closed").removeClass("last").children("a").removeClass("clicked hover search"),this.cntr==t.focused)for(var i in t.inst)if(i!=this.cntr&&i!=this.container.attr("id")){t.inst[i].focus();break}t.inst[this.cntr]=!1,t.inst[this.container.attr("id")]=!1,delete t.inst[this.cntr],delete t.inst[this.container.attr("id")],t.cntr--}}}e.tree={datastores:{},plugins:{},defaults:{data:{async:!1,type:"html",opts:{method:"GET",url:!1}},selected:!1,opened:[],languages:[],ui:{dots:!0,animation:0,scroll_spd:4,theme_path:!1,theme_name:"default",selected_parent_close:"select_parent",selected_delete:"select_previous"},types:{default:{clickable:!0,renameable:!0,deletable:!0,creatable:!0,draggable:!0,max_children:-1,max_depth:-1,valid_children:"all",icon:{image:!1,position:!1}}},rules:{multiple:!1,multitree:"none",type_attr:"rel",createat:"bottom",drag_copy:"ctrl",drag_button:"left",use_max_children:!0,use_max_depth:!0,max_children:-1,max_depth:-1,valid_children:"all"},lang:{new_node:"New folder",loading:"Loading ..."},callback:{beforechange:function(e,t){return!0},beforeopen:function(e,t){return!0},beforeclose:function(e,t){return!0},beforemove:function(e,t,i,s){return!0},beforecreate:function(e,t,i,s){return!0},beforerename:function(e,t,i){return!0},beforedelete:function(e,t){return!0},beforedata:function(t,i){return{id:e(t).attr("id")||0}},ondata:function(e,t){return e},onparse:function(e,t){return e},onhover:function(e,t){},onselect:function(e,t){},ondeselect:function(e,t){},onchange:function(e,t){},onrename:function(e,t,i){},onmove:function(e,t,i,s,r){},oncopy:function(e,t,i,s,r){},oncreate:function(e,t,i,s,r){},ondelete:function(e,t,i){},onopen:function(e,t){},onopen_all:function(e){},onclose_all:function(e){},onclose:function(e,t){},error:function(e,t){},ondblclk:function(e,t){t.toggle_branch.call(t,e),t.select_branch.call(t,e)},onrgtclk:function(e,t,i){},onload:function(e){},oninit:function(e){},onfocus:function(e){},ondestroy:function(e){},onsearch:function(e,t){e.addClass("search")},ondrop:function(e,t,i,s){},check:function(e,t,i,s){return i},check_move:function(e,t,i,s){return!0}},plugins:{}},create:function(){return new t},focused:function(){return t.inst[t.focused]},reference:function(i){var s=e(i);return s.size()||(s=e("#"+i)),s.size()?(s=s.is(".tree")?s.attr("id"):s.parents(".tree:eq(0)").attr("id"),t.inst[s]||null):null},rollback:function(i){for(var s in i)if(i.hasOwnProperty(s)){var r=t.inst[s],n=!r.locked;n&&r.lock(!0),r.inp=!1,r.container.html(i[s].html).find(".dragged").removeClass("dragged").end().find(".hover").removeClass("hover"),i[s].selected&&(r.selected=e("#"+i[s].selected),r.selected_arr=[],r.container.find("a.clicked").each(function(){r.selected_arr.push(r.get_node(this))})),n&&r.lock(!1),delete n,delete r}},drop_mode:function(i){i=e.extend(i,{show:!1,type:"default",str:"Foreign node"}),t.drag_drop.foreign=!0,t.drag_drop.isdown=!0,t.drag_drop.moving=!0,t.drag_drop.appended=!1,t.drag_drop.f_type=i.type,t.drag_drop.f_data=i,i.show?(t.drag_drop.drag_help=e("<div id='jstree-dragged' class='tree tree-default'><ul><li class='last dragged foreign'><a href='#'><ins>&nbsp;</ins>"+i.str+"</a></li></ul></div>"),t.drag_drop.drag_node=t.drag_drop.drag_help.find("li:eq(0)")):(t.drag_drop.drag_help=!1,t.drag_drop.drag_node=!1),!1!==e.tree.drag_start&&e.tree.drag_start.call(null,!1)},drag_start:!1,drag:!1,drag_end:!1},e.fn.tree=function(i){return this.each(function(){var s=e.extend({},i);t.inst&&t.inst[e(this).attr("id")]&&t.inst[e(this).attr("id")].destroy(),!1!==s&&(new t).init(this,s)})},t.cntr=0,t.inst={},t.themes=[],t.drag_drop={isdown:!1,drag_node:!1,drag_help:!1,dragged:!1,init_x:!1,init_y:!1,moving:!1,origin_tree:!1,marker:!1,move_type:!1,ref_node:!1,appended:!1,foreign:!1,droppable:[],open_time:!1,scroll_time:!1},t.mouseup=function(i){var s=t.drag_drop;if(s.open_time&&clearTimeout(s.open_time),s.scroll_time&&clearTimeout(s.scroll_time),s.moving&&!1!==e.tree.drag_end&&e.tree.drag_end.call(null,i,s),!1===s.foreign&&s.drag_node&&s.drag_node.size()){if(s.drag_help.remove(),s.move_type)(r=t.inst[s.ref_node.parents(".tree:eq(0)").attr("id")])&&r.moved(s.dragged,s.ref_node,s.move_type,!1,"on"==s.origin_tree.settings.rules.drag_copy||"ctrl"==s.origin_tree.settings.rules.drag_copy&&i.ctrlKey);s.move_type=!1,s.ref_node=!1}if(!1!==s.foreign){var r;if(s.drag_help&&s.drag_help.remove(),s.move_type)(r=t.inst[s.ref_node.parents(".tree:eq(0)").attr("id")])&&r.callback("ondrop",[s.f_data,r.get_node(s.ref_node).get(0),s.move_type,r]);s.foreign=!1,s.move_type=!1,s.ref_node=!1}if(t.drag_drop.marker&&t.drag_drop.marker.hide(),s.dragged&&s.dragged.size()&&s.dragged.removeClass("dragged"),s.dragged=!1,s.drag_help=!1,s.drag_node=!1,s.f_type=!1,s.f_data=!1,s.init_x=!1,s.init_y=!1,s.moving=!1,s.appended=!1,s.origin_tree=!1,s.isdown)return s.isdown=!1,i.preventDefault(),i.stopPropagation(),!1},t.mousemove=function(i){var s=t.drag_drop,r=!1;if(s.isdown){if(!s.moving&&Math.abs(s.init_x-i.pageX)<5&&Math.abs(s.init_y-i.pageY)<5)return i.preventDefault(),i.stopPropagation(),!1;if(s.moving||(t.drag_drop.moving=!0,r=!0),s.open_time&&clearTimeout(s.open_time),!1!==s.drag_help&&(s.appended||(!1!==s.foreign&&(s.origin_tree=e.tree.focused()),e("body").append(s.drag_help),s.w=s.drag_help.width(),s.appended=!0),s.drag_help.css({left:i.pageX+5,top:i.pageY+15})),r&&!1!==e.tree.drag_start&&e.tree.drag_start.call(null,i,s),!1!==e.tree.drag&&e.tree.drag.call(null,i,s),"DIV"==i.target.tagName&&"jstree-marker"==i.target.id)return!1;var n=e(i.target);n.is("ins")&&(n=n.parent());var a=n.is(".tree")?n:n.parents(".tree:eq(0)");if(0==a.size()||!t.inst[a.attr("id")])return s.scroll_time&&clearTimeout(s.scroll_time),!1!==s.drag_help&&s.drag_help.find("li:eq(0) ins").addClass("forbidden"),s.move_type=!1,s.ref_node=!1,t.drag_drop.marker.hide(),!1;var l=t.inst[a.attr("id")];l.off_height(),s.scroll_time&&clearTimeout(s.scroll_time),s.scroll_time=setTimeout(function(){l.scroll_check(i.pageX,i.pageY)},50);var o=!1;a.scrollTop();if("A"==i.target.tagName||"INS"==i.target.tagName){if(n.is("#jstree-dragged"))return!1;l.get_node(i.target).hasClass("closed")&&(s.open_time=setTimeout(function(){l.open_branch(n)},500));var d={x:(p=n.offset()).left-1,y:i.pageY-p.top},c=[];c=d.y<l.li_height/3+1?["before","inside","after"]:d.y>2*l.li_height/3-1?["after","inside","before"]:d.y<l.li_height/2?["inside","before","after"]:["inside","after","before"];var h=!1,u=0==s.foreign?s.origin_tree.container.find("li.dragged"):s.f_type;if(e.each(c,function(e,t){if(l.check_move(u,n,t))return o=t,h=!0,!1}),h){switch(o){case"before":d.y=p.top-2,t.drag_drop.marker.attr("class","marker");break;case"after":d.y=p.top-2+l.li_height,t.drag_drop.marker.attr("class","marker");break;case"inside":d.x-=2,d.y=p.top-2+l.li_height/2,t.drag_drop.marker.attr("class","marker_plus")}s.move_type=o,s.ref_node=e(i.target),!1!==s.drag_help&&s.drag_help.find(".forbidden").removeClass("forbidden"),t.drag_drop.marker.css({left:d.x,top:d.y}).show()}}if((n.is(".tree")||n.is("ul"))&&0==n.find("li:eq(0)").size()){var p=n.offset();s.move_type="inside",s.ref_node=a.children("ul:eq(0)"),!1!==s.drag_help&&s.drag_help.find(".forbidden").removeClass("forbidden"),t.drag_drop.marker.attr("class","marker_plus"),t.drag_drop.marker.css({left:p.left+10,top:p.top+15}).show()}else("A"!=i.target.tagName&&"INS"!=i.target.tagName||!h)&&(!1!==s.drag_help&&s.drag_help.find("li:eq(0) ins").addClass("forbidden"),s.move_type=!1,s.ref_node=!1,t.drag_drop.marker.hide());return i.preventDefault(),i.stopPropagation(),!1}return!0},e(function(){e(document).bind("mousemove.jstree",t.mousemove),e(document).bind("mouseup.jstree",t.mouseup)}),t.cut_copy={copy_nodes:!1,cut_nodes:!1},t.css=!1,t.get_css=function(e,s){e=e.toLowerCase();var r=t.css.cssRules||t.css.rules,n=0;do{if(r.length&&n>r.length+5)return!1;if(r[n].selectorText&&r[n].selectorText.toLowerCase()==e)return 1==s?(t.css.removeRule&&document.styleSheets[i].removeRule(n),t.css.deleteRule&&document.styleSheets[i].deleteRule(n),!0):r[n]}while(r[++n]);return!1},t.add_css=function(e){return!t.get_css(e)&&(t.css.insertRule?t.css.insertRule(e+" { }",0):t.css.addRule(e,null,0),t.get_css(e))},t.remove_css=function(e){return t.get_css(e,!0)},t.add_sheet=function(e){if(e.str){var t=document.createElement("style");return t.type="text/css",t.styleSheet?t.styleSheet.cssText=e.str:t.appendChild(document.createTextNode(e.str)),document.getElementsByTagName("head")[0].appendChild(t),t.sheet}if(e.url){if(!document.createStyleSheet){var i=document.createElement("link");return i.rel="stylesheet",i.type="text/css",i.media="all",i.href=e.url,document.getElementsByTagName("head")[0].appendChild(i),i.styleSheet}try{document.createStyleSheet(e.url)}catch(e){}}},e(function(){var e=navigator.userAgent.toLowerCase(),i=(e.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],s='/* TREE LAYOUT */ .tree ul { margin:0 0 0 7px;padding:0 0 0 0;list-style-type:none; } .tree li { display:block;min-height:20px;line-height:20px;padding:0 0 0 12px;margin:0 0 0 0;clear:both; } .tree li ul { display:none; } .tree li a, .tree li span { display:inline-block;line-height:18px;height:18px;color:#000;white-space:nowrap;text-decoration:none;padding:1px 4px 1px 4px;margin:0; } .tree li a:focus { outline:none; } .tree li a input, .tree li span input { margin:0;padding:0;display:inline-block;height:14px;border:1px solid #FFF;background:#FFF;font-size:12px;font-family:Verdana; } .tree li a input:not([class="xxx"]), .tree li span input:not([class="xxx"]) { padding:1px 0px; } /* FOR DOTS */ .tree .ltr li.last { float:left; } .tree > ul li.last { overflow:visible; } /* OPEN OR CLOSE */ .tree li.open ul { display:block; } .tree li.closed ul { display:none !important; } /* FOR DRAGGING */ #jstree-dragged { position:absolute;top:-10px;left:-10px;margin:0;padding:0; } #jstree-dragged ul ul ul { display:none; } #jstree-marker { padding:0;margin:0;line-height:5px;font-size:1px;overflow:hidden;height:5px;position:absolute;left:-45px;top:-30px;z-index:1000;background-color:transparent;background-repeat:no-repeat;display:none; } #jstree-marker.marker { width:45px;background-position:-32px top; } #jstree-marker.marker_plus { width:5px;background-position:right top; } /* BACKGROUND DOTS */ .tree li li { overflow:hidden; } .tree > .ltr > li { display:table; } /* ICONS */ .tree ul ins { display:inline-block;text-decoration:none;width:16px; height:16px; } .tree .ltr ins { margin:0 4px 0 0; } ';/msie/.test(e)&&!/opera/.test(e)&&(6==parseInt(i)&&(s+='.tree li { height:20px;zoom:1; } .tree li li { overflow:visible; } .tree .ltr li.last { margin-top: expression( (this.previousSibling && /open/.test(this.previousSibling.className) ) ? "-2px" : "0"); } .marker { width:45px;background-position:-32px top; } .marker_plus { width:5px;background-position:right top; }'),7==parseInt(i)&&(s+='.tree li li { overflow:visible; } .tree .ltr li.last { margin-top: expression( (this.previousSibling && /open/.test(this.previousSibling.className) ) ? "-2px" : "0"); }')),/opera/.test(e)&&(s+='.tree > ul > li.last:after { content:".";display: block;height:1px;clear:both;visibility:hidden; }'),/mozilla/.test(e)&&!/(compatible|webkit)/.test(e)&&0==i.indexOf("1.8")&&(s+=".tree .ltr li a { display:inline;float:left; } .tree li ul { clear:both; }"),t.css=t.add_sheet({str:s})})}(jQuery);
!function(t){t.extend(t.tree.datastores,{html:function(){return{get:function(e,a,n){return e&&t(e).size()?t("<div>").append(a.get_node(e).clone()).html():a.container.children("ul:eq(0)").html()},parse:function(t,e,a,n){return n&&n.call(null,t),t},load:function(e,a,n,s){n.url?t.ajax({type:n.method,url:n.url,data:e,dataType:"html",success:function(t,e){s.call(null,t)},error:function(t,e,n){s.call(null,!1),a.error(n+" "+e)}}):s.call(null,n.static||a.container.children("ul:eq(0)").html())}}},json:function(){return{get:function(e,a,n){var s=this;if(e=e&&0!=t(e).size()?t(e):a.container.children("ul").children("li"),n||(n={}),n.outer_attrib||(n.outer_attrib=["id","rel","class"]),n.inner_attrib||(n.inner_attrib=[]),e.size()>1){var i=[];return e.each(function(){i.push(s.get(this,a,n))}),i}if(0==e.size())return[];var r={attributes:{},data:{}};e.hasClass("open")&&(r.data.state="open"),e.hasClass("closed")&&(r.data.state="closed");for(var l in n.outer_attrib){if(n.outer_attrib.hasOwnProperty(l))void 0!==(c="class"==n.outer_attrib[l]?e.attr(n.outer_attrib[l]).replace(/(^| )last( |$)/gi," ").replace(/(^| )(leaf|closed|open)( |$)/gi," "):e.attr(n.outer_attrib[l]))&&c.toString().replace(" ","").length>0&&(r.attributes[n.outer_attrib[l]]=c),delete c}if(a.settings.languages.length){for(var l in a.settings.languages)if(a.settings.languages.hasOwnProperty(l)){var g=e.children("a."+a.settings.languages[l]);if(n.force||n.inner_attrib.length||g.children("ins").get(0).style.backgroundImage.toString().length||g.children("ins").get(0).className.length){if(r.data[a.settings.languages[l]]={},r.data[a.settings.languages[l]].title=a.get_text(e,a.settings.languages[l]),g.children("ins").get(0).style.className.length&&(r.data[a.settings.languages[l]].icon=g.children("ins").get(0).style.className),g.children("ins").get(0).style.backgroundImage.length&&(r.data[a.settings.languages[l]].icon=g.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","")),n.inner_attrib.length){r.data[a.settings.languages[l]].attributes={};for(var u in n.inner_attrib){if(n.inner_attrib.hasOwnProperty(u))void 0!==(c=g.attr(n.inner_attrib[u]))&&c.toString().replace(" ","").length>0&&(r.data[a.settings.languages[l]].attributes[n.inner_attrib[u]]=c),delete c}}}else r.data[a.settings.languages[l]]=a.get_text(e,a.settings.languages[l])}}else{g=e.children("a");if(r.data.title=a.get_text(e),g.children("ins").size()&&g.children("ins").get(0).className.length&&(r.data.icon=g.children("ins").get(0).className),g.children("ins").size()&&g.children("ins").get(0).style.backgroundImage.length&&(r.data.icon=g.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","")),n.inner_attrib.length){r.data.attributes={};for(var u in n.inner_attrib){var c;if(n.inner_attrib.hasOwnProperty(u))void 0!==(c=g.attr(n.inner_attrib[u]))&&c.toString().replace(" ","").length>0&&(r.data.attributes[n.inner_attrib[u]]=c),delete c}}}return e.children("ul").size()>0&&(r.children=[],e.children("ul").children("li").each(function(){r.children.push(s.get(this,a,n))})),r},parse:function(t,e,a,n){if("[object Array]"===Object.prototype.toString.apply(t)){for(var s="",i=0;i<t.length;i++)"function"!=typeof t[i]&&(s+=this.parse(t[i],e,a));return n&&n.call(null,s),s}if(!t||!t.data)return n&&n.call(null,!1),"";s="";s+="<li ";var r=!1;if(t.attributes)for(var i in t.attributes)t.attributes.hasOwnProperty(i)&&("class"==i?(s+=" class='"+t.attributes[i]+" ","closed"!=t.state&&"open"!=t.state||(s+=" "+t.state+" "),s+="' ",r=!0):s+=" "+i+"='"+t.attributes[i]+"' ");if(r||"closed"!=t.state&&"open"!=t.state||(s+=" class='"+t.state+"' "),s+=">",e.settings.languages.length)for(i=0;i<e.settings.languages.length;i++){if((g={}).href="",g.style="",g.class=e.settings.languages[i],t.data[e.settings.languages[i]]&&"undefined"!=(typeof t.data[e.settings.languages[i]].attributes).toLowerCase())for(var l in t.data[e.settings.languages[i]].attributes)t.data[e.settings.languages[i]].attributes.hasOwnProperty(l)&&("style"==l||"class"==l?g[l]+=" "+t.data[e.settings.languages[i]].attributes[l]:g[l]=t.data[e.settings.languages[i]].attributes[l]);s+="<a";for(var l in g)g.hasOwnProperty(l)&&(s+=" "+l+'="'+g[l]+'" ');s+=">",t.data[e.settings.languages[i]]&&t.data[e.settings.languages[i]].icon?s+="<ins "+(-1==t.data[e.settings.languages[i]].icon.indexOf("/")?" class='"+t.data[e.settings.languages[i]].icon+"' ":" style='background-image:url(\""+t.data[e.settings.languages[i]].icon+"\");' ")+">&nbsp;</ins>":s+="<ins>&nbsp;</ins>",s+=("undefined"!=(typeof t.data[e.settings.languages[i]].title).toLowerCase()?t.data[e.settings.languages[i]].title:t.data[e.settings.languages[i]])+"</a>"}else{var g;if((g={}).href="",g.style="",g.class="","undefined"!=(typeof t.data.attributes).toLowerCase())for(var i in t.data.attributes)t.data.attributes.hasOwnProperty(i)&&("style"==i||"class"==i?g[i]+=" "+t.data.attributes[i]:g[i]=t.data.attributes[i]);s+="<a";for(var i in g)g.hasOwnProperty(i)&&(s+=" "+i+'="'+g[i]+'" ');s+=">",t.data.icon?s+="<ins "+(-1==t.data.icon.indexOf("/")?" class='"+t.data.icon+"' ":" style='background-image:url(\""+t.data.icon+"\");' ")+">&nbsp;</ins>":s+="<ins>&nbsp;</ins>",s+=("undefined"!=(typeof t.data.title).toLowerCase()?t.data.title:t.data)+"</a>"}if(t.children&&t.children.length){s+="<ul>";for(i=0;i<t.children.length;i++)s+=this.parse(t.children[i],e,a);s+="</ul>"}return s+="</li>",n&&n.call(null,s),s},load:function(e,a,n,s){n.static?s.call(null,n.static):t.ajax({type:n.method,url:n.url,data:e,dataType:"json",success:function(t,e){s.call(null,t)},error:function(t,e,n){s.call(null,!1),a.error(n+" "+e)}})}}}})}(jQuery);
